## SUMMARY MAP

ğŸ“ src/
â”œâ”€â”€ ğŸ“ backend/
â”‚   â”œâ”€â”€ ğŸ“ .temp/
â”‚   â”‚   Purpose: Supabase CLI version tracking
â”‚   â”‚   Details:
â”‚   â”‚   - Tracks CLI version information
â”‚   â”‚   - Manages local development state
â”‚   â”‚   - Used by Supabase CLI for version control
â”‚   â”‚  
â”‚   â”œâ”€â”€ ğŸ“ functions/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ _shared/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ constants.ts
â”‚   â”‚   â”‚   â”‚   â”‚   Purpose: Manages Cross-Origin Resource Sharing (CORS) configuration for Supabase Edge Functions, ensuring secure API access.
â”‚   â”‚   â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   â”‚   â”‚   - Defines a whitelist of `ALLOWED_ORIGINS` for production (monketer.com, www.monketer.com) and common development ports (localhost:3000, localhost:5173).
â”‚   â”‚   â”‚   â”‚   â”‚   - Exports `corsHeadersFactory(requestOrigin)`: A function that dynamically generates appropriate CORS headers. It returns the `requestOrigin` if it's in `ALLOWED_ORIGINS`, otherwise defaults to the primary production origin. This is the recommended method.
â”‚   â”‚   â”‚   â”‚   â”‚   - Specifies allowed HTTP headers (authorization, x-client-info, apikey, content-type) and methods (GET, POST, PUT, DELETE, OPTIONS).
â”‚   â”‚   â”‚   â”‚   â”‚   - Sets `Access-Control-Max-Age` to `86400` (24 hours) for preflight request caching.
â”‚   â”‚   â”‚   â”‚   â”‚   - Includes legacy `corsHeaders` with a wildcard `Access-Control-Allow-Origin: '*'`, which is deprecated but maintained for backward compatibility.
â”‚   â”‚   â”‚   â”‚   â”‚   Usage:
â”‚   â”‚   â”‚   â”‚   â”‚   - `corsHeadersFactory` is imported and used by multiple Supabase Edge Functions (`clarify-user-intent`, `generate-email-changes`, `manage-pending-changes`, `send-preview-email`) to set response headers for main requests, error responses, and OPTIONS preflight requests.
â”‚   â”‚   â”‚   â”‚   â”‚   - The legacy `corsHeaders` is directly used for OPTIONS preflight request handling in `generate-email-changes/index.ts`.
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ uuid-utils.ts
â”‚   â”‚   â”‚   â”‚   â”‚   Purpose: Provides deprecated UUID validation and cleaning utilities; acts as a proxy for the shared implementation for backward compatibility.
â”‚   â”‚   â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   â”‚   â”‚   - Marked as `@deprecated`; new code should use `src/shared/lib/uuid-utils.ts`.
â”‚   â”‚   â”‚   â”‚   â”‚   - `cleanUuid(id: string)`: Sanitizes potentially malformed UUIDs by removing trailing digits/spaces. Returns cleaned UUID if it matches the pattern, otherwise the original trimmed ID.
â”‚   â”‚   â”‚   â”‚   â”‚   - `isValidUuid(id: string)`: Validates if a string is a properly formatted UUID using a regex.
â”‚   â”‚   â”‚   â”‚   â”‚   Usage: Likely used in older backend code requiring UUID utilities before the shared version was prioritized.
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ uuid.ts
â”‚   â”‚   â”‚   â”‚       Purpose: Provides a deprecated, backend-specific UUID v4 generation function (`generateId`).
â”‚   â”‚   â”‚   â”‚       Details:
â”‚   â”‚   â”‚   â”‚       - Uses the `uuid` npm package (v4) for generation.
â”‚   â”‚   â”‚   â”‚       - Marked as `@deprecated`; new code should use `src/shared/lib/uuid.ts`.
â”‚   â”‚   â”‚   â”‚       - Exists due to historical path resolution issues in the Deno/Supabase environment.
â”‚   â”‚   â”‚   â”‚       - Functionally identical to the shared implementation.
â”‚   â”‚   â”‚   â”‚       Usage: Likely not actively used in current backend functions, as services like `semanticParser.ts` import `generateId` from the shared path (`@shared/lib/uuid`). It was intended for backend services requiring unique ID generation before shared path resolution was robust or if direct npm `uuid` usage was not preferred.
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ services/
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ differ.ts
â”‚   â”‚   â”‚       â”‚   Purpose: Provides a Deno/Supabase adapter for the V2 template diffing service.
â”‚   â”‚   â”‚       â”‚   Details:
â”‚   â”‚   â”‚       â”‚   - Imports `DifferCore` from `src/shared/services/differ.ts` and re-exports types.
â”‚   â”‚   â”‚       â”‚   - Extends `DifferCore` to create a `DifferV2` class, passing a lodash instance.
â”‚   â”‚   â”‚       â”‚   - Primarily acts as a wrapper to make the shared differ service usable in the Deno environment.
â”‚   â”‚   â”‚       â”‚   - Diffing logic resides in the shared `DifferCore`.
â”‚   â”‚   â”‚       â”‚   Usage: Imported and used by `src/backend/functions/generate-email-changes/index.ts` to compare template versions and generate a diff result, which is then stored as pending changes.
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ htmlGenerator.ts
â”‚   â”‚   â”‚       â”‚   Purpose: Frontend (browser) adapter for the V2 HTML email generation service, extending `HtmlGeneratorCore`.
â”‚   â”‚   â”‚       â”‚   Details:
â”‚   â”‚   â”‚       â”‚   - Adapts `HtmlGeneratorCore` (from `src/shared/services/htmlGenerator.ts`) for the frontend.
â”‚   â”‚   â”‚       â”‚   - Overrides element generation (e.g., for buttons, images) to:
â”‚   â”‚   â”‚       â”‚     â€¢ Detect placeholder content using an `isPlaceholder` utility.
â”‚   â”‚   â”‚       â”‚     â€¢ Render placeholder elements with specific styling and text cues (e.g., "(Link Required)").
â”‚   â”‚   â”‚       â”‚     â€¢ Add `data-*` attributes (`data-element-id`, `data-property-path`, `data-placeholder`) to placeholder elements, enabling the visual editor to identify and manage them.
â”‚   â”‚   â”‚       â”‚   - Includes enhanced HTML `<head>` content with more robust CSS resets and email client compatibility meta tags.
â”‚   â”‚   â”‚       â”‚   - Exports `HtmlGeneratorV2` class and a convenience `generateHtml(template)` function.
â”‚   â”‚   â”‚       â”‚   Usage: Used by `EditorContext` to render the live preview of the email template, providing the necessary data attributes for interactive editing of placeholders.
â”‚   â”‚   â”‚       â”‚
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ semanticParser.ts
â”‚   â”‚   â”‚           Purpose: Frontend (browser/Node.js) adapter for the V2 email HTML semantic parsing service, extending `SemanticParserCore`.
â”‚   â”‚   â”‚           Details:
â”‚   â”‚   â”‚           - Adapts `SemanticParserCore` (from `src/shared/services/semanticParser.ts`) for the frontend.
â”‚   â”‚   â”‚           - Uses `JSDOM` to create a DOM from an HTML string for parsing.
â”‚   â”‚   â”‚           - Implements the `parse(html)` method to convert HTML into a structured `EmailTemplateV2` object.
â”‚   â”‚   â”‚           - Overrides methods for:
â”‚   â”‚   â”‚             â€¢ Extracting global styles (body styles, content width).
â”‚   â”‚   â”‚             â€¢ Locating the main email container and parsing sections/elements.
â”‚   â”‚   â”‚             â€¢ Determining element types, potentially supporting more frontend-specific types (subtext, quote, code, list).
â”‚   â”‚   â”‚           - Exports `SemanticParser` class.
â”‚   â”‚   â”‚           Usage: Used to convert raw HTML (e.g., from an imported email or a previous version) into the structured `EmailTemplateV2` format that the editor and other services can work with.
â”‚   â”‚   â”‚
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ clarify-user-intent/
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts
â”‚   â”‚       Purpose: AI conversation middleware, served as a Supabase Edge Function.
â”‚   â”‚       Details:
â”‚   â”‚       - Core Functionality:
â”‚   â”‚         â€¢ Analyzes user messages for ambiguity
â”‚   â”‚         â€¢ Asks targeted clarifying questions
â”‚   â”‚         â€¢ Provides structured data for email generation
â”‚   â”‚       - Input Processing:
â”‚   â”‚         â€¢ User message analysis
â”‚   â”‚         â€¢ Chat history context
â”‚   â”‚         â€¢ Current email structure
â”‚   â”‚         â€¢ Ongoing clarification context
â”‚   â”‚       - Response Types:
â”‚   â”‚         â€¢ Clarification questions with suggestions
â”‚   â”‚         â€¢ Complete structured data for email generation
â”‚   â”‚       - Technical Features:
â”‚   â”‚         â€¢ Token limit management
â”‚   â”‚         â€¢ Context window optimization
â”‚   â”‚         â€¢ JSON response validation
â”‚   â”‚         â€¢ Error handling and recovery
â”‚   â”‚       Usage: Invoked as an HTTP POST endpoint by the frontend. It receives user messages, chat history, and current email context. Based on its analysis, it either returns a request for clarification or a structured set of instructions for the `generate-email-changes` function. It utilizes an OpenAI model (e.g., `gpt-4o-mini`) for its core logic.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ generate-email-changes/
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts
â”‚   â”‚       Purpose: Supabase Edge Function to apply AI-driven modifications to email templates and save them.
â”‚   â”‚       Details:
â”‚   â”‚       - Core Functionality:
â”‚   â”‚         â€¢ Receives a structured `GenerateEmailChangesPayload` (likely from `clarify-user-intent`) detailing the desired email modifications, including a "perfect prompt" and elements to process.
â”‚   â”‚         â€¢ Interacts with an OpenAI model (e.g., `gpt-4o-mini`), providing a system prompt tailored by the operation `mode` ('ask', 'edit', 'major'), to get structured changes or a diff.
â”‚   â”‚         â€¢ Merges AI-suggested changes into the V2 email template.
â”‚   â”‚         â€¢ Validates the updated template using `validateEmailTemplateV2`.
â”‚   â”‚         â€¢ Generates new HTML using the backend `HtmlGenerator`.
â”‚   â”‚         â€¢ Updates the project's `semantic_email_v2` and `current_html` in the Supabase database.
â”‚   â”‚         â€¢ Computes a diff between the old and new template using the backend `DifferV2` and saves it as `pending_changes` in Supabase.
â”‚   â”‚       - Key Dependencies:
â”‚   â”‚         â€¢ Supabase client (for DB operations).
â”‚   â”‚         â€¢ OpenAI API (for generating changes).
â”‚   â”‚         â€¢ `corsHeadersFactory`, `HtmlGenerator` (adapter), `DifferV2` (adapter) from `../_shared/`.
â”‚   â”‚         â€¢ Shared types (`EmailTemplateV2`, `TemplateDiffResult`).
â”‚   â”‚         â€¢ Internal Helpers: `getProjectDataV2`, `updateProjectV2`, `savePendingChanges` for database interactions.
â”‚   â”‚       Usage: Invoked as an HTTP POST endpoint, typically after `clarify-user-intent` has produced a clear set of instructions. It returns the newly modified template, its HTML, and any generated pending changes.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ manage-pending-changes/
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts
â”‚   â”‚       Purpose: Supabase Edge Function to accept or reject a set of pending V2 template changes for a project.
â”‚   â”‚       Details:
â”‚   â”‚       - Core Functionality:
â”‚   â”‚         â€¢ Handles HTTP POST requests with a `projectId` and an `action` ('accept' or 'reject').
â”‚   â”‚         â€¢ Fetches the project's current `semantic_email_v2` and its associated `pending_changes` (which is expected to be a `TemplateDiffResult` containing `oldTemplate` and `newTemplate` states).
â”‚   â”‚         â€¢ If 'accept':
â”‚   â”‚           - Assumes `pending_changes.diff.newTemplate` is the target state.
â”‚   â”‚           - Generates HTML from this target state using `HtmlGeneratorCore` (shared).
â”‚   â”‚           - Calls Supabase RPC `manage_accept_transaction` to update the project with the new template/HTML, mark changes as 'accepted', and increment project version.
â”‚   â”‚         â€¢ If 'reject':
â”‚   â”‚           - Assumes `pending_changes.diff.oldTemplate` is the target state to revert to.
â”‚   â”‚           - Generates HTML from this reverted state using `HtmlGeneratorCore` (shared).
â”‚   â”‚           - Calls Supabase RPC `manage_reject_transaction` to update the project with the reverted template/HTML and mark changes as 'rejected'.
â”‚   â”‚       - Key Dependencies:
â”‚   â”‚         â€¢ Supabase client (for DB operations and RPC calls).
â”‚   â”‚         â€¢ `corsHeadersFactory` (backend shared).
â”‚   â”‚         â€¢ `HtmlGeneratorCore` (shared service).
â”‚   â”‚         â€¢ Shared types (`EmailTemplate`, `PendingChange`).
â”‚   â”‚         â€¢ Supabase RPCs: `manage_accept_transaction`, `manage_reject_transaction`.
â”‚   â”‚       - Note: Contains `applyPendingChanges` and `applyRevert` helper functions that manipulate template objects based on change arrays, but these are not directly used by the main 'accept'/'reject' logic of this endpoint, which instead relies on the full old/new templates stored within the pending diff.
â”‚   â”‚       Usage: Invoked as an HTTP POST endpoint by the frontend to finalize or discard a set of proposed email template modifications.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ send-preview-email/
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts
â”‚   â”‚       Purpose: Supabase Edge Function to send an email with provided HTML content, typically for preview purposes.
â”‚   â”‚       Details:
â”‚   â”‚       - Core Functionality:
â”‚   â”‚         â€¢ Accepts a POST request with `recipientEmail` and `emailHtml` in the JSON payload.
â”‚   â”‚         â€¢ Uses `nodemailer` configured with Gmail SMTP (credentials from environment variables `GMAIL_USER`, `GMAIL_APP_PASSWORD`) to send the email.
â”‚   â”‚         â€¢ The provided `emailHtml` is used directly as the email body.
â”‚   â”‚       - Key Dependencies:
â”‚   â”‚         â€¢ `nodemailer` npm package.
â”‚   â”‚         â€¢ `corsHeadersFactory` from `../_shared/lib/constants.ts`.
â”‚   â”‚         â€¢ Gmail account credentials stored as Supabase secrets.
â”‚   â”‚       Usage: Invoked as an HTTP POST endpoint by the frontend to send a rendered HTML email to a user-specified address for previewing.
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ deno.json
â”‚   â”‚   â”‚   Purpose: Deno configuration specific to the `send-preview-email` function.
â”‚   â”‚   â”‚   Details: Manages Deno runtime settings, task scripts, import maps, or permissions, potentially related to its use of npm modules like `nodemailer` via esm.sh or similar.
â”‚   â”‚   â””â”€â”€ ğŸ“„ .npmrc
â”‚   â”‚       Purpose: NPM configuration file for the `send-preview-email` function.
â”‚   â”‚       Details: Specifies settings for npm package management if direct npm dependencies or private registries are used with Deno for this function.
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“„ import_map.json
â”‚       Purpose: Defines path aliases for Deno module imports within the Supabase Edge Functions.
â”‚       Details: Maps short aliases (like `@/`, `shared/`, `@/types/v2/`, `@/services/v2/`) to their actual relative paths (e.g., `../../src/`, `./_shared/`, `../../src/types/v2/`, `../../src/services/v2/`). This simplifies import statements in the Edge Function code.
â”‚       Usage: Used by the Deno runtime when executing functions in `src/backend/functions/` to resolve aliased imports. Referenced by `src/backend/deno.jsonc`.
â”‚
â”œâ”€â”€ ğŸ“ components/
â”‚   â”œâ”€â”€ ğŸ“„ ChatInterface.tsx
â”‚   â”‚   Purpose: Provides the main chat interface for user-AI interactions
â”‚   â”‚   Details:
â”‚   â”‚   - Handles three interaction modes:
â”‚   â”‚     â€¢ Major Edit: For significant changes
â”‚   â”‚     â€¢ Minor Edit: For small adjustments
â”‚   â”‚     â€¢ Just Ask: For questions without edits
â”‚   â”‚   - Message Features:
â”‚   â”‚     â€¢ Renders markdown content
â”‚   â”‚     â€¢ Supports clarification workflows
â”‚   â”‚     â€¢ Shows suggestion buttons
â”‚   â”‚     â€¢ Displays loading states
â”‚   â”‚     â€¢ Auto-scrolls to new messages
â”‚   â”‚   - Input Features:
â”‚   â”‚     â€¢ Multi-line support (Shift+Enter)
â”‚   â”‚     â€¢ Focus management
â”‚   â”‚     â€¢ Loading states
â”‚   â”‚     â€¢ Placeholder text
â”‚   â”‚   - UI Components:
â”‚   â”‚     â€¢ Mode selection buttons
â”‚   â”‚     â€¢ Message history area
â”‚   â”‚     â€¢ Input area with send button
â”‚   â”‚     â€¢ Clarification banner when needed
â”‚   â”‚   Dependencies:
â”‚   â”‚   - UI: Button, Textarea, ScrollArea, ReactMarkdown
â”‚   â”‚   - Icons: Send, Paperclip, Mic, CornerDownLeft, AlertTriangle, Wand2
â”‚   â”‚   - Utils: cn (className utility)
â”‚   â”‚   State Management:
â”‚   â”‚   - Local: Input value, scroll position
â”‚   â”‚   - Props: Messages, clarification state, loading state, mode selection
â”‚   â”‚   Usage: Rendered as the right-hand panel within the main `Editor` page (`src/pages/Editor.tsx`). It receives its state (messages, loading states, mode) and callbacks (message sending, mode changes) from the `EditorContext`.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ EmailHtmlRenderer.tsx
â”‚   â”‚   Purpose: Renders email content in an isolated iframe environment
â”‚   â”‚   Details:
â”‚   â”‚   - Transforms HTML email templates into interactive previews
â”‚   â”‚   - Handles two types of placeholders (images and links)
â”‚   â”‚   - Manages background colors and styling
â”‚   â”‚   - Provides auto-resizing functionality
â”‚   â”‚   - Implements security measures (HTML escaping)
â”‚   â”‚   - Uses ResizeObserver for dynamic content
â”‚   â”‚   Dependencies: React, forwardRef, useEffect, useRef
â”‚   â”‚   Usage: Likely used by the `EmailPreview` component (`src/components/EmailPreview.tsx`) to render the core HTML content within an iframe and process placeholders.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ EmailPreview.tsx
â”‚   â”‚   Purpose: Renders an interactive email preview within an iframe, displaying overlays for pending changes and clickable placeholders.
â”‚   â”‚   Details:
â”‚   â”‚   - Core Functionality:
â”‚   â”‚     â€¢ Uses `EmailHtmlRenderer` to display the base HTML content in an iframe.
â”‚   â”‚     â€¢ Manages an overlay system on top of the iframe for:
â”‚   â”‚       - Visualizing pending changes (adds/edits) with styled borders.
â”‚   â”‚       - Creating interactive, clickable overlays for image and link placeholders identified from the `semanticTemplate`.
â”‚   â”‚     â€¢ Handles coordinate mapping between the iframe and the parent document for accurate overlay positioning, accounting for scroll and iframe boundaries.
â”‚   â”‚   - Props:
â”‚   â”‚     â€¢ `currentHtml`: The HTML string to render.
â”‚   â”‚     â€¢ `pendingChanges`: Array of pending changes to highlight.
â”‚   â”‚     â€¢ `previewMode`: 'light' or 'dark' (applies a CSS filter for dark mode).
â”‚   â”‚     â€¢ `previewDevice`: 'desktop' or 'mobile' (adjusts preview width).
â”‚   â”‚     â€¢ `semanticTemplate`: The structured email template data used to identify placeholders.
â”‚   â”‚     â€¢ `onPlaceholderActivate`: Callback function triggered when a placeholder overlay is clicked, providing element ID, property path, and type.
â”‚   â”‚   - Key Dependencies:
â”‚   â”‚     â€¢ `EmailHtmlRenderer` (for iframe rendering and initial placeholder transformation).
â”‚   â”‚     â€¢ `isPlaceholder` utility (from `@/features/services/htmlGenerator`).
â”‚   â”‚     â€¢ `cn` utility.
â”‚   â”‚     â€¢ React hooks (`useEffect`, `useRef`, `useCallback`).
â”‚   â”‚   - Technical Notes:
â”‚   â”‚     â€¢ Uses `requestAnimationFrame` (via `waitForPaintCycle`) for smooth overlay updates.
â”‚   â”‚     â€¢ Listens to iframe scroll and resize events to keep overlays synchronized.
â”‚   â”‚   Usage: Imported and used by `EmailPreviewPanel` (`src/components/editor/EmailPreviewPanel.tsx`) to display the email content. It receives HTML, template data, and interaction callbacks from the `EditorContext` (via `EmailPreviewPanel`).
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ FeaturesSection.tsx
â”‚   â”‚   Purpose: Displays key application features in a responsive grid on the main landing page.
â”‚   â”‚   Details:
â”‚   â”‚   - Content:
â”‚   â”‚     â€¢ Hardcoded array of features: "Create", "Automate", "Analyze", each with a description and an Unsplash image URL.
â”‚   â”‚     â€¢ Section header: "Powerful Features", "Everything you need to excel at email marketing", and a subtitle.
â”‚   â”‚   - Layout:
â”‚   â”‚     â€¢ Responsive grid of feature cards (1 to 3 columns).
â”‚   â”‚     â€¢ Each card contains an image (with hover zoom), title, and description.
â”‚   â”‚   - Styling: Uses Tailwind CSS for styling, including hover effects on cards.
â”‚   â”‚   Dependencies: None (React functional component with local data).
â”‚   â”‚   Usage: Rendered on the main landing page (`src/pages/Index.tsx`) as part of the page's marketing content.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ Footer.tsx
â”‚   â”‚   Purpose: Site-wide footer providing navigation and branding
â”‚   â”‚   Details:
â”‚   â”‚   - Content Structure:
â”‚   â”‚     â€¢ Organized into 4 navigation categories:
â”‚   â”‚       - Product: Features, pricing, roadmap, guides
â”‚   â”‚       - Company: About, blog, careers, partners
â”‚   â”‚       - Support: Help, docs, contact, status
â”‚   â”‚       - Legal: Privacy, terms, cookies
â”‚   â”‚     â€¢ Dynamic copyright year
â”‚   â”‚     â€¢ Brand section with logo and tagline
â”‚   â”‚   - Layout:
â”‚   â”‚     â€¢ Responsive 3-column grid on XL screens
â”‚   â”‚     â€¢ Left column: Brand section
â”‚   â”‚     â€¢ Center/Right: Navigation sections (2x2 grid)
â”‚   â”‚   - UI Features:
â”‚   â”‚     â€¢ Dark theme (bg-gray-900)
â”‚   â”‚     â€¢ Hover effects on navigation links
â”‚   â”‚     â€¢ Semantic HTML structure with ARIA labels
â”‚   â”‚   Dependencies:
â”‚   â”‚   - Components: Link from react-router-dom
â”‚   â”‚   - Styling: Tailwind CSS
â”‚   â”‚   State Management:
â”‚   â”‚   - Stateless component
â”‚   â”‚   - Uses static navigation data structure
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ HeroSection.tsx
â”‚   â”‚   Purpose: Main hero section for the landing page, capturing initial user email descriptions and guiding them to authentication.
â”‚   â”‚   Details:
â”‚   â”‚   - Content:
â”‚   â”‚     â€¢ Headline, subtitle.
â”‚   â”‚     â€¢ `Textarea` for user to describe their desired email.
â”‚   â”‚     â€¢ "Generate Email" button.
â”‚   â”‚   - Functionality:
â”‚   â”‚     â€¢ On "Generate Email" submit:
â”‚   â”‚       - Shows an authentication dialog ("Sign Up" / "Sign In").
â”‚   â”‚       - On auth choice, saves the textarea content to `localStorage` (key: `savedEmailContent`) and navigates to `/signup` or `/login`.
â”‚   â”‚     â€¢ Loads `savedEmailContent` from `localStorage` on mount to pre-fill textarea.
â”‚   â”‚   - Styling: Decorative gradient background, Tailwind CSS.
â”‚   â”‚   Dependencies:
â”‚   â”‚   - `ArrowRight` icon (lucide-react).
â”‚   â”‚   - UI Components: `Textarea`, `Button`, `Dialog` (from `./ui/`).
â”‚   â”‚   - `useNavigate` (react-router-dom).
â”‚   â”‚   - React hooks (`useState`, `useEffect`).
â”‚   â”‚   Usage: Rendered as the primary section in `src/pages/Index.tsx`.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ Navbar.tsx
â”‚   â”‚   Purpose: Application's main responsive navigation bar.
â”‚   â”‚   Details:
â”‚   â”‚   - Content & Branding:
â”‚   â”‚     â€¢ Displays the brand "monketer" with a `Mail` icon, linking to `/`.
â”‚   â”‚   - Authentication Links:
â”‚   â”‚     â€¢ "Sign in" button linking to `/login`.
â”‚   â”‚     â€¢ "Sign up" button linking to `/signup`.
â”‚   â”‚   - Responsive Behavior:
â”‚   â”‚     â€¢ Desktop: Horizontal layout with visible auth buttons.
â”‚   â”‚     â€¢ Mobile: Collapsible hamburger menu which, when opened, shows auth buttons vertically.
â”‚   â”‚   - Styling:
â”‚   â”‚     â€¢ Fixed position at the top.
â”‚   â”‚     â€¢ Semi-transparent background with a blur effect.
â”‚   â”‚     â€¢ Uses Tailwind CSS and "monketer-purple" theme color.
â”‚   â”‚   Dependencies:
â”‚   â”‚   - React (`useState`).
â”‚   â”‚   - `@/components/ui/button`.
â”‚   â”‚   - `Link` from `react-router-dom`.
â”‚   â”‚   - `Mail` icon from `lucide-react`.
â”‚   â”‚   Usage: Rendered at the top of the main landing page (`src/pages/Index.tsx`). Potentially used on other main application pages that require global navigation.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ TestimonialsSection.tsx
â”‚   â”‚   Purpose: Marketing component showcasing customer success stories
â”‚   â”‚   Details:
â”‚   â”‚   - Content Structure:
â”‚   â”‚     â€¢ Static testimonials array with customer feedback
â”‚   â”‚     â€¢ Each testimonial includes:
â”‚   â”‚       - Unique identifier
â”‚   â”‚       - Customer quote
â”‚   â”‚       - Name and title
â”‚   â”‚       - Company information
â”‚   â”‚   - Layout Design:
â”‚   â”‚     â€¢ Responsive grid system (1/2/3 columns)
â”‚   â”‚     â€¢ Card-based presentation
â”‚   â”‚     â€¢ Centered section header
â”‚   â”‚     â€¢ Consistent spacing and alignment
â”‚   â”‚   - Visual Elements:
â”‚   â”‚     â€¢ Light purple section background
â”‚   â”‚     â€¢ White testimonial cards
â”‚   â”‚     â€¢ Gradient avatars with initials
â”‚   â”‚     â€¢ Decorative quote marks
â”‚   â”‚     â€¢ Subtle shadows and borders
â”‚   â”‚   Dependencies:
â”‚   â”‚   - No external component dependencies
â”‚   â”‚   - Styling: Tailwind CSS
â”‚   â”‚   State Management:
â”‚   â”‚   - Stateless component
â”‚   â”‚   - Uses static testimonial data
â”‚   â”‚   Usage: Rendered on the main landing page (`src/pages/Index.tsx`) to showcase customer feedback.
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ editor/
â”‚   â”‚   Purpose: Editor-specific UI components
â”‚   â”‚   Details:
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EditorHeader.tsx
â”‚   â”‚   â”‚   Purpose: Displays the top navigation bar for the email editor interface.
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - Back Button: Navigates to `/dashboard`.
â”‚   â”‚   â”‚   - Editable Project Title: Allows inline editing of the project title, synced with `EditorContext`.
â”‚   â”‚   â”‚   - Settings Button: Placeholder for future project settings functionality (currently disabled).
â”‚   â”‚   â”‚   - Layout: Sticky header with back (left), title (center), settings (right).
â”‚   â”‚   â”‚   Dependencies: `lucide-react` (ArrowLeft, Settings), `@/components/ui/button`, `react-router-dom` (`useNavigate`), `@/features/contexts/EditorContext` (`useEditor`).
â”‚   â”‚   â”‚   Usage: Rendered as the main header within the `EditorContent` component (`src/pages/Editor.tsx`).
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmailPreviewControls.tsx
â”‚   â”‚   â”‚   Purpose: Provides UI controls for the email preview panel, allowing users to toggle display modes.
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - Dark/Light Mode Toggle: Switch with `Sun` and `Moon` icons, controls `isDarkMode` from `EditorContext`.
â”‚   â”‚   â”‚   - Device View Toggle: Switch with `Monitor` and `Smartphone` icons, controls `isMobileView` from `EditorContext`.
â”‚   â”‚   â”‚   - Layout: Sticky, centered controls with adaptive background for dark/light theme. Disabled during loading states.
â”‚   â”‚   â”‚   Dependencies: `lucide-react` (icons), `@/components/ui/switch`, `cn` utility, `useEditor` hook.
â”‚   â”‚   â”‚   Usage: Rendered within `src/components/editor/EmailPreviewPanel.tsx` to provide preview customization options.
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EmailPreviewPanel.tsx
â”‚   â”‚   â”‚   Purpose: Displays the rendered email preview along with controls.
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - Integrates with `EmailPreview` component for the actual rendering within an iframe and overlay management.
â”‚   â”‚   â”‚   - Provides UI controls for the preview via `EmailPreviewControls` (toggling dark/light mode, mobile/desktop view), shown only when content is available.
â”‚   â”‚   â”‚   - Displays a `PendingChangesBar` to manage proposed modifications.
â”‚   â”‚   â”‚   - Manages the overall layout of the preview area.
â”‚   â”‚   â”‚   - HTML source: Uses `livePreviewHtml` from context if available, otherwise `projectData.current_html`.
â”‚   â”‚   â”‚   - Conditionally renders preview and controls based on loading states and content availability (`projectData.semantic_email_v2`).
â”‚   â”‚   â”‚   - Receives state and callbacks from `EditorContext` (e.g., `livePreviewHtml`, `isDarkMode`, `isMobileView`, `handlePlaceholderActivation`, `pendingChanges`).
â”‚   â”‚   â”‚   - Accepts an optional `fileInputRef` prop (currently for potential future use by child components like `EmailPreview`).
â”‚   â”‚   â”‚   Dependencies:
â”‚   â”‚   â”‚     â€¢ `EmailPreview` (from `@/components/EmailPreview`).
â”‚   â”‚   â”‚     â€¢ `EmailPreviewControls` (from `./EmailPreviewControls`).
â”‚   â”‚   â”‚     â€¢ `PendingChangesBar` (from `./PendingChangesBar`).
â”‚   â”‚   â”‚     â€¢ `useEditor` hook.
â”‚   â”‚   â”‚     â€¢ `cn` utility.
â”‚   â”‚   â”‚   Usage: Rendered as the left-hand panel within the main `EditorContent` component in `src/pages/Editor.tsx`.
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ InitialPromptScreen.tsx
â”‚   â”‚   â”‚   Purpose: Screen for users to input their initial email generation prompt, shown when starting a new project or if an existing project has no email content.
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - UI Elements:
â”‚   â”‚   â”‚     â€¢ `Mail` icon.
â”‚   â”‚   â”‚     â€¢ Title and descriptive text.
â”‚   â”‚   â”‚     â€¢ Single `Input` field for the prompt with a placeholder.
â”‚   â”‚   â”‚     â€¢ "Generate Email with AI" `Button`.
â”‚   â”‚   â”‚   - Functionality:
â”‚   â”‚   â”‚     â€¢ Uses `initialInputValue` from `EditorContext` for the input field.
â”‚   â”‚   â”‚     â€¢ On submit (button click or Enter), calls `handleSendMessage(prompt, 'major')` from `EditorContext`.
â”‚   â”‚   â”‚     â€¢ Shows a validation error if the prompt is empty.
â”‚   â”‚   â”‚   - Dependencies:
â”‚   â”‚   â”‚     â€¢ `Mail` icon (lucide-react).
â”‚   â”‚   â”‚     â€¢ `Button`, `Input` (from `@/components/ui/`).
â”‚   â”‚   â”‚     â€¢ `useEditor` hook (`@/features/contexts/EditorContext`).
â”‚   â”‚   â”‚   State Management:
â”‚   â”‚   â”‚   - Uses `initialInputValue`, `setInitialInputValue`, `handleSendMessage`, `isLoading` from `EditorContext`.
â”‚   â”‚   â”‚   - Local state for validation visibility.
â”‚   â”‚   â”‚   Usage: Rendered conditionally within `EditorContent` in `src/pages/Editor.tsx` when `actualProjectId` is not set (and not loading).
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoadingScreen.tsx
â”‚   â”‚   â”‚   Purpose: Displays various loading and transitional states for the editor UI
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - Adaptable: Shows different messages/animations based on a `type` prop (e.g., "loading", "generating", "clarifying").
â”‚   â”‚   â”‚   - Visuals: Typically includes a spinner/animation and text.
â”‚   â”‚   â”‚   - Used during project loading, AI generation, or when AI is clarifying.
â”‚   â”‚   â”‚   Dependencies: UI components (spinner, text), possibly icons.
â”‚   â”‚   â”‚   Usage: Rendered conditionally within `EditorContent`
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PendingChangesBar.tsx
â”‚   â”‚   â”‚   Purpose: Floating action bar for accepting or rejecting all pending email changes.
â”‚   â”‚   â”‚   Details:
â”‚   â”‚   â”‚   - Visibility: Only shown if there are pending changes.
â”‚   â”‚   â”‚   - Layout: Absolutely positioned at the bottom-center of its parent, styled as a floating bar.
â”‚   â”‚   â”‚   - Controls:
â”‚   â”‚   â”‚     â€¢ "Reject All" button (red, `X` icon), calls `handleRejectAll` from context.
â”‚   â”‚   â”‚     â€¢ "Accept All" button (green, `Check` icon), calls `handleAcceptAll` from context.
â”‚   â”‚   â”‚   - Both buttons are disabled during loading states.
â”‚   â”‚   â”‚   Dependencies: `lucide-react` (icons), `@/components/ui/button`, `useEditor` hook.
â”‚   â”‚   â”‚   Usage: Rendered within `src/components/editor/EmailPreviewPanel.tsx` to allow bulk actions on pending template modifications.
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ ui/
â”‚   â”‚       Purpose: Collection of foundational, reusable UI components (e.g., Button, Input, Dialog, Card, Switch).
â”‚   â”‚       Details: These are typically generic building blocks, often sourced from or inspired by a UI library like shadcn/ui, styled with Tailwind CSS. They ensure a consistent look and feel across the application. Specific props and behaviors follow common UI component patterns. Detailed documentation for each individual primitive is omitted for brevity.
â”‚   â”‚
â””â”€â”€ ğŸ“ features/
    Purpose: Business logic by domain
    Details:
    â”œâ”€â”€ ğŸ“ auth/
    â”‚   Purpose: Handles user authentication and session management using Supabase.
    â”‚   Details: Provides a React Context and a custom hook (`useAuth`) for auth operations.
    â”‚   â””â”€â”€ ğŸ“„ useAuth.tsx
    â”‚       Purpose: Provides a React Context and custom hook (`useAuth`) for managing user authentication state and interactions with Supabase.
    â”‚       Details:
    â”‚       - Manages `session`, `user`, and `loading` states.
    â”‚       - Synchronizes with Supabase auth events (`onAuthStateChange`, `getSession`).
    â”‚       - Exports `AuthProvider` component to wrap the application or parts of it.
    â”‚       - Exports `useAuth` hook to access:
    â”‚         â€¢ `session: Session | null`
    â”‚         â€¢ `user: User | null`
    â”‚         â€¢ `loading: boolean`
    â”‚         â€¢ `signIn(email, password)`: Authenticates a user.
    â”‚         â€¢ `signUp(email, password, username)`: Registers a new user (username defaults to email, also attempts to create a `user_info` record).
    â”‚         â€¢ `signOut()`: Logs out the user.
    â”‚       - Integrates `useToast` for user feedback on auth operations.
    â”‚       Usage: `AuthProvider` is used in `App.tsx` to provide global auth context. `useAuth` is used by components like `ProtectedRoute`, `RedirectIfAuthenticated`, and pages like `Login.tsx`, `Signup.tsx`, `Dashboard.tsx` to manage auth state and trigger auth actions.
    â”‚
    â”œâ”€â”€ ğŸ“ contexts/
    â”‚   Purpose: Provides React Context for sharing state across different parts of a feature or the application.
    â”‚   Details: Centralizes state management for complex UI sections like the email editor.
    â”‚   â””â”€â”€ ğŸ“„ EditorContext.tsx
    â”‚       Purpose: Central React Context (`EditorContext`) and provider (`EditorProvider`) for managing all state and operations of the email editor.
    â”‚       Details:
    â”‚       - Manages comprehensive editor state including:
    â”‚         â€¢ Project data (`projectData`, `projectTitle`, `actualProjectId`).
    â”‚         â€¢ UI states (`isLoading`, `isLoadingProject`, `isDarkMode`, `isMobileView`, `selectedMode`).
    â”‚         â€¢ Content (`chatMessages`, `livePreviewHtml`, `pendingChanges`, `EmailTemplateV2` structure).
    â”‚         â€¢ AI clarification flow (`isClarifying`, `clarificationConversation`, `clarificationContext`).
    â”‚         â€¢ Placeholder editing (`editingPlaceholder`, `linkInputValue`).
    â”‚       - Initializes editor by fetching or creating project data based on URL parameters and user auth.
    â”‚       - Provides core handler functions for:
    â”‚         â€¢ Sending messages to AI for edits, questions, or generation (`handleSendMessage`).
    â”‚         â€¢ Managing clarification dialogues with AI.
    â”‚         â€¢ Accepting/rejecting pending template changes (`handleAcceptAll`, `handleRejectAll`).
    â”‚         â€¢ Updating project title, element properties (links, images).
    â”‚         â€¢ Navigating to send preview page.
    â”‚       - Integrates with `projectService`, Supabase client, `HtmlGeneratorV2`, and `useAuth`.
    â”‚       - Exports `useEditor` hook for components to access context.
    â”‚       Usage: `EditorProvider` wraps the main `Editor` page component (`src/pages/Editor.tsx`). `useEditor` is consumed by numerous components within the editor UI (e.g., `ChatInterface`, `EmailPreviewPanel`, `EditorHeader`, etc.) to display data and trigger actions.
    â”‚
    â”œâ”€â”€ ğŸ“ services/
    â”‚   Purpose: Contains modules that provide specific functionalities, often acting as clients or wrappers for backend services, shared core logic, or complex operations.
    â”‚   Details: These services are typically used by contexts or page components to fetch data, perform actions, and encapsulate business logic.
    â”‚   â”œâ”€â”€ ğŸ“„ differ.ts
    â”‚   â”‚   Purpose: Frontend (browser) adapter for the V2 template diffing service.
    â”‚   â”‚   Details:
    â”‚   â”‚   - Adapts the shared `DifferCore` (from `src/shared/services/differ.ts`) for the frontend environment.
    â”‚   â”‚   - Uses the standard `lodash` library.
    â”‚   â”‚   - Exports `DifferV2` class, which instantiates `DifferCore` with lodash.
    â”‚   â”‚   - The core diffing logic is in the shared `DifferCore`.
    â”‚   â”‚   - Re-exports diff-related types from the shared service.
    â”‚   â”‚   Usage: Likely used by `EditorContext` or other frontend services when needing to compute differences between email template versions, for example, to generate `pendingChanges`.
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ğŸ“„ htmlGenerator.ts
    â”‚   â”‚   Purpose: Frontend (browser) adapter for the V2 HTML email generation service, extending `HtmlGeneratorCore`.
    â”‚   â”‚   Details:
    â”‚   â”‚   - Adapts `HtmlGeneratorCore` (from `src/shared/services/htmlGenerator.ts`) for the frontend.
    â”‚   â”‚   - Overrides element generation (e.g., for buttons, images) to:
    â”‚   â”‚     â€¢ Detect placeholder content using an `isPlaceholder` utility.
    â”‚   â”‚     â€¢ Render placeholder elements with specific styling and text cues (e.g., "(Link Required)").
    â”‚   â”‚     â€¢ Add `data-*` attributes (`data-element-id`, `data-property-path`, `data-placeholder`) to placeholder elements, enabling the visual editor to identify and manage them.
    â”‚   â”‚   - Includes enhanced HTML `<head>` content with more robust CSS resets and email client compatibility meta tags.
    â”‚   â”‚   - Exports `HtmlGeneratorV2` class and a convenience `generateHtml(template)` function.
    â”‚   â”‚   Usage: Used by `EditorContext` to render the live preview of the email template, providing the necessary data attributes for interactive editing of placeholders.
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ğŸ“„ semanticParser.ts
    â”‚   â”‚   Purpose: Frontend (browser/Node.js) adapter for the V2 email HTML semantic parsing service, extending `SemanticParserCore`.
    â”‚   â”‚   Details:
    â”‚   â”‚   - Adapts `SemanticParserCore` (from `src/shared/services/semanticParser.ts`) for the frontend.
    â”‚   â”‚   - Uses `JSDOM` to create a DOM from an HTML string for parsing.
    â”‚   â”‚   - Implements the `parse(html)` method to convert HTML into a structured `EmailTemplateV2` object.
    â”‚   â”‚   - Overrides methods for:
    â”‚   â”‚     â€¢ Extracting global styles (body styles, content width).
    â”‚   â”‚     â€¢ Locating the main email container and parsing sections/elements.
    â”‚   â”‚     â€¢ Determining element types, potentially supporting more frontend-specific types (subtext, quote, code, list).
    â”‚   â”‚   - Exports `SemanticParser` class.
    â”‚   â”‚   Usage: Used to convert raw HTML (e.g., from an imported email or a previous version) into the structured `EmailTemplateV2` format that the editor and other services can work with.
    â”‚   â”‚
    â”‚   â””â”€â”€ ğŸ“„ projectService.ts
    â”‚       Purpose: Handles frontend interactions with Supabase for projects, templates (V1 & V2, including V1 to V2 upgrade logic), chat, and pending changes.
    â”‚       Details:
    â”‚       - This service is a key part of the frontend's data management. It includes logic for fetching, creating, updating, and deleting project data.
    â”‚       - It also manages email templates, including a crucial V1 to V2 upgrade path which involves client-side HTML generation to prepare V1 templates for the V2 editor.
    â”‚       - Chat history and pending template changes are also managed through this service.
    â”‚       - It uses the Supabase client for backend communication.
    â”‚       Usage:
    â”‚       - Used throughout the `EditorContext` (`src/features/contexts/EditorContext.tsx`) for most data operations related to projects, templates, and chat.
    â”‚       - Potentially used by other UI components or hooks that need direct access to project/template data, although primary interaction is expected via `EditorContext`.

â””â”€â”€ ğŸ“ Types/
    â”œâ”€â”€ ğŸ“„ ai.ts
    â”‚   Purpose: Defines TypeScript interfaces for the AI clarification flow.
    â”‚   Details:
    â”‚   - This file exports types that structure the communication between the frontend and the AI backend, particularly for the "clarify user intent" feature.
    â”‚   - `ClarificationMessage`: Represents a single message in the AI chat, detailing sender, text, suggestions, and whether it's a question. A simpler version, `SimpleClarificationMessage` (defined in `src/features/types/editor.ts`), is often used in the UI.
    â”‚   - `QuestionResponse`: Structure for when the AI needs more information from the user. Contains the question and suggestions.
    â”‚   - `CompleteResponse`: Structure for when the AI has enough information and provides the "perfect prompt" and elements to process.
    â”‚   - `ClarificationApiResponse`: A union type of `QuestionResponse` and `CompleteResponse`.
    â”‚   Usage:
    â”‚   - `ClarificationMessage`: Imported in `src/features/contexts/EditorContext.tsx`. The related `SimpleClarificationMessage` (from `src/features/types/editor.ts`) is used by `EditorContext.tsx` for managing the clarification conversation state and by `src/components/ChatInterface.tsx` for rendering messages.
    â”‚   - `QuestionResponse`, `CompleteResponse`, `ClarificationApiResponse`: These types (or identically named local definitions) are handled in `src/features/contexts/EditorContext.tsx` when processing the response from the `/clarify-user-intent` Supabase Edge Function. The backend function `src/backend/functions/clarify-user-intent/index.ts` also defines and uses these response types.
    â”‚
    â”œâ”€â”€ ğŸ“„ editor.ts
    â”‚   Purpose: Defines various TypeScript interfaces and types primarily used within the frontend email editor's context and UI components.
    â”‚   Details:
    â”‚   - Imports `EmailTemplateV2Type` from `../../shared/types/validators`.
    â”‚   - Defines core email structure elements: `EmailElement`, `EmailSection`, `EmailTemplate`.
    â”‚   - `PendingChange`: Structure for a pending modification.
    â”‚   - `ChatMessage`: Base type for chat messages.
    â”‚   - `ExtendedChatMessage`: Enriched `ChatMessage` for UI (role, type, suggestions).
    â”‚   - `SimpleClarificationMessage`: Simplified AI clarification message for UI (role, content).
    â”‚   - `Project`: Data structure for a user's project.
    â”‚   - `EmailPreviewProps`: Props for the `EmailPreview` component.
    â”‚   Usage:
    â”‚   - Fundamental for `EditorContext` (`src/features/contexts/EditorContext.tsx`) for state management (email structure, chat, pending changes, project data).
    â”‚   - Consumed by UI components like `EmailPreview.tsx` (`EmailPreviewProps`) and `ChatInterface.tsx` (`ExtendedChatMessage`, `SimpleClarificationMessage`).
    â””â”€â”€ ğŸ“„ index.ts
        Purpose: Barrel file re-exporting types from shared and local type modules.
        Details:
        - Re-exports all types from `shared/types/` (elements, sections, template, validators, diffs).
        - Re-exports all types from `./ai`.
        - Explicitly re-exports specific types (`Project`, `ChatMessage`, etc.) from `./editor` to avoid potential naming conflicts.
        Usage: Provides a single entry point (`@/features/types`) for importing commonly used types across the frontend features, simplifying import statements.

â””â”€â”€ ğŸ“ utils/
    â””â”€â”€ ğŸ“„ placeholderUtils.ts
        Purpose: Provides utility functions for identifying placeholder image URLs.
        Details:
        - Exports `isPlaceholder(src)` function.
        - Checks for null/empty strings, '#', placeholder service URLs (via.placeholder.com), base64 1x1 pixel GIFs, and '@@PLACEHOLDER_IMAGE@@'.
        Usage: Used by image rendering/processing logic (e.g., `EmailHtmlRenderer.tsx`, frontend `HtmlGenerator.ts`) to detect and handle placeholder images.

â””â”€â”€ ğŸ“ hooks/
    â”œâ”€â”€ ğŸ“„ use-mobile.tsx
    â”‚   Purpose: Provides React hooks for detecting mobile environments and related device characteristics.
    â”‚   Details:
    â”‚   - Defines `MOBILE_CONFIG` (breakpoints, aspect ratio).
    â”‚   - Exports `DeviceInfo` interface (`isMobile`, `deviceType`, `orientation`, `hasTouch`, `viewport`).
    â”‚   - Exports `useMobileDetection()` hook:
    â”‚     - Tracks device info using `useState`/`useEffect`.
    â”‚     - Detects touch capability.
    â”‚     - Listens to `resize` and `orientationchange` events.
    â”‚     - Determines `deviceType` (small-phone, large-phone, tablet, desktop) and `orientation`.
    â”‚     - Considers device mobile if width < breakpoint OR has touch.
    â”‚   - Exports legacy `useIsMobile()` hook returning just the boolean.
    â”‚   Usage: Used in UI components (`src/pages/`, `src/components/`) for conditional rendering/styling based on device type, orientation, or touch capability.
    â”‚
    â””â”€â”€ ğŸ“„ use-toast.ts
        Purpose: Implements a custom toast notification system using React state and context/module state.
        Details:
        - Defines `TOAST_LIMIT`, `TOAST_REMOVE_DELAY`.
        - Uses a reducer pattern (`actionTypes`, `Action`, `reducer`) to manage toast state (`memoryState`, `listeners`).
        - Handles delayed removal for animations (`addToRemoveQueue`).
        - Exports `toast({...})` function to create toasts (returns object with `id`, `dismiss`, `update`).
        - Exports `useToast()` hook providing state (`toasts`) and control functions (`toast`, `dismiss`).
        Usage: `useToast()` hook called in components to trigger notifications via `toast()`. A central `Toaster` component likely consumes the state to render toasts.

â””â”€â”€ ğŸ“ integrations/
    â””â”€â”€ ğŸ“ supabase/
        â”œâ”€â”€ ğŸ“„ client.ts
        â”‚   Purpose: Initializes and exports the global Supabase client instance. Handles configuration and provides utility functions.
        â”‚   Details:
        â”‚   - Reads `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` from env.
        â”‚   - Validates URL and key presence, throws error if missing.
        â”‚   - Creates and exports singleton `supabase` client.
        â”‚   - Exports `toJson` utility for safe JSON parsing (handles comments).
        â”‚   - Exports `handleSupabaseError` for standardized error logging.
        â”‚   Usage: The `supabase` client is imported globally for all Supabase interactions (auth, DB, functions, etc.). Helpers used as needed.
        â”‚
        â””â”€â”€ ğŸ“„ types.ts
            Purpose: Provides TypeScript definitions generated from the Supabase database schema for type safety.
            Details:
            - Typically generated by Supabase CLI.
            - Defines main `Database` type mirroring the schema (Tables, Views, Functions, etc.).
            - Includes detailed types for tables (`chat_messages`, `projects`, etc.) with `Row`, `Insert`, `Update` shapes.
            - Provides generic helper types (`Tables<T>`, `TablesInsert<T>`, etc.).
            Usage: Imported across the application (e.g., services, components) for type-safe database interactions via the Supabase client.

â””â”€â”€ ğŸ“ lib/
    â”œâ”€â”€ ğŸ“„ utils.ts
    â”‚   Purpose: UI utility functions, focusing on CSS class handling with Tailwind CSS.
    â”‚   Details:
    â”‚   - Exports the `cn` function.
    â”‚   - Uses `clsx` for conditional class joining and `tailwind-merge` to resolve Tailwind conflicts.
    â”‚   Usage: Widely used in `.tsx` components for clean and dynamic class name management.
    â”‚
    â”œâ”€â”€ ğŸ“„ uuid-utils.ts
    â”‚   Purpose: Deprecated frontend UUID validation/cleaning utilities (proxy/duplicate of shared version).
    â”‚   Details:
    â”‚   - Marked `@deprecated`, advises using `src/shared/lib/uuid-utils.ts`.
    â”‚   - Implements `cleanUuid` and `isValidUuid`.
    â”‚   - Duplicated from shared lib due to historical import issues.
    â”‚   Usage: Used in older frontend code requiring UUID validation.
    â”‚
    â””â”€â”€ ğŸ“„ uuid.ts
        Purpose: Deprecated frontend UUID v4 generation function (proxy to shared version).
        Details:
        - Marked `@deprecated`, advises using `@/shared/lib/uuid.ts`.
        - Imports and re-exports `generateId` from the shared library.
        - Exists for backward compatibility.
        Usage: Used in older frontend code needing UUID generation.

â””â”€â”€ ğŸ“ pages/
    Purpose: Top-level components representing distinct application pages or views.
    Details: These components are typically mapped to specific routes in the application router (`src/core/App.tsx`). They compose smaller components to build the page UI.
    â”œâ”€â”€ ğŸ“„ Dashboard.tsx
    â”‚   Purpose: Main user dashboard for managing email projects.
    â”‚   Details:
    â”‚   - Fetches and displays a list of user projects using `projectService.getUserProjects` and `projectService.getUsernameFromId`.
    â”‚   - Uses `useState` for projects, loading state, and username.
    â”‚   - Uses `useAuth` for user context and sign out.
    â”‚   - Uses `useToast` for error feedback.
    â”‚   - Renders a table (`@/components/ui/table`) to display project names and last edited dates.
    â”‚   - Provides "Open" links navigating to `/editor/:username/:projectName`.
    â”‚   - Provides a "Create Project" / "New Project" button navigating to `/editor`.
    â”‚   - Handles loading and empty states.
    â”‚   Usage: Routed at `/dashboard` within `App.tsx`, protected by `ProtectedRoute`.
    â”‚
    â”œâ”€â”€ ğŸ“„ Editor.tsx
    â”‚   Purpose: Main entry point and layout component for the email editor interface.
    â”‚   Details:
    â”‚   - Sets up the `EditorProvider` from `@/features/contexts/EditorContext`.
    â”‚   - Renders `EditorContent`, which consumes the context and orchestrates the editor UI.
    â”‚   - `EditorContent` composes `EditorHeader`, `ResizablePanelGroup` containing `EmailPreviewPanel` (or `LoadingScreen` / `InitialPromptScreen`) and `ChatInterface`, and `PlaceholderEditModal`.
    â”‚   - Manages different UI states based on context (loading, prompting, generating, editing).
    â”‚   - Handles file input for image uploads via a `useRef`.
    â”‚   Usage: Routed at `/editor`, `/editor/:projectId`, and `/editor/:username/:projectName` within `App.tsx`, protected by `ProtectedRoute`.
    â”‚
    â”œâ”€â”€ ğŸ“„ Index.tsx
    â”‚   Purpose: Main public landing page for the application.
    â”‚   Details:
    â”‚   - Composes marketing section components: `Navbar`, `HeroSection`, `FeaturesSection`, `TestimonialsSection`, `Footer` (all from `@/components/`).
    â”‚   - Uses a flex column layout to structure the page.
    â”‚   Usage: Routed at `/` within `App.tsx`. Access is conditional based on authentication status via `RedirectIfAuthenticated`.
    â”‚
    â”œâ”€â”€ ğŸ“„ Login.tsx
    â”‚   Purpose: Authentication page for users to sign in.
    â”‚   Details:
    â”‚   - Renders a login form with email and password fields (`input`).
    â”‚   - Uses `useState` for form state and loading indicator.
    â”‚   - Calls `signIn` from `useAuth` hook on submission.
    â”‚   - Includes links to signup (`/signup`) and potentially password reset.
    â”‚   - Uses `@/components/ui/button` and `lucide-react` icon.
    â”‚   Usage: Routed at `/login` within `App.tsx`. Access is conditional via `RedirectIfAuthenticated`.
    â”‚
    â”œâ”€â”€ ğŸ“„ NotFound.tsx
    â”‚   Purpose: Displays a 404 error page for non-existent routes.
    â”‚   Details:
    â”‚   - Displays a standard "404 Page not found" message.
    â”‚   - Uses `useAuth` to check user authentication status.
    â”‚   - Provides a primary navigation button that links to `/dashboard` (if authenticated) or `/` (if not).
    â”‚   - Conditionally shows a link to `/editor` for authenticated users.
    â”‚   - Uses `useLocation` to log the invalid path.
    â”‚   Usage: Routed as the catch-all (`*`) route in `App.tsx`.
    â”‚
    â”œâ”€â”€ ğŸ“„ PrivacyPolicy.tsx
    â”‚   Purpose: Displays the company's privacy policy.
    â”‚   Details:
    â”‚   - Static content page.
    â”‚   - Uses `@/components/ui/container` and `@/components/ui/typography` for layout and styling.
    â”‚   - Displays policy sections (Introduction, Collection, Usage, Security, Rights, Changes, Contact).
    â”‚   - Dynamically sets the "Last updated" date.
    â”‚   Usage: Routed at `/privacy-policy` in `App.tsx`. Publicly accessible.
    â”‚
    â”œâ”€â”€ ğŸ“„ SendEmailPage.tsx
    â”‚   Purpose: Allows users to send a preview of their generated email and copy its HTML.
    â”‚   Details:
    â”‚   - Retrieves email HTML from `sessionStorage` ('emailHtmlToSend') on mount. Redirects to `/editor` if not found.
    â”‚   - Provides an input field (`@/components/ui/input`) for the recipient's email address.
    â”‚   - Provides a button to send the preview, which calls the `send-preview-email` Supabase Edge Function.
    â”‚   - Displays the email HTML in a read-only textarea (`@/components/ui/textarea`).
    â”‚   - Provides a button to copy the HTML to the clipboard (`navigator.clipboard.writeText`).
    â”‚   - Uses `useState`, `useEffect`, `useNavigate`, `useToast`.
    â”‚   - Uses `lucide-react` icons (`Loader2`, `Copy`, `Send`, `ArrowLeft`).
    â”‚   Usage: Routed at `/send-email` in `App.tsx`, protected by `ProtectedRoute`. Likely navigated to from the `Editor` page.
    â”‚
    â”œâ”€â”€ ğŸ“„ Signup.tsx
    â”‚   Purpose: User registration page for creating new accounts.
    â”‚   Details:
    â”‚   - Renders a signup form with email, password, and terms agreement checkbox.
    â”‚   - Uses `useState` for form state and loading indicator.
    â”‚   - Calls `signUp` from `useAuth` hook on submission. Navigates to `/editor` on success.
    â”‚   - Includes specific error handling for rate limiting (`useToast`).
    â”‚   - Includes links to login (`/login`), terms (`#`), and privacy policy (`#`).
    â”‚   - Uses `@/components/ui/button` and `lucide-react` icon.
    â”‚   Usage: Routed at `/signup` within `App.tsx`. Access is conditional via `RedirectIfAuthenticated`.
    â”‚
    â””â”€â”€ ğŸ“„ TermsOfService.tsx
        Purpose: Displays the company's terms of service.
        Details:
        - Static content page, similar structure to `PrivacyPolicy.tsx`.
        - Uses `@/components/ui/container` and `@/components/ui/typography`.
        - Displays terms sections (Introduction, Use of Service, Responsibilities, IP, Liability, Changes, Contact).
        - Dynamically sets the "Last updated" date.
        Usage: Routed at `/terms-of-service` in `App.tsx`. Publicly accessible.

â””â”€â”€ ğŸ“ shared/
    Purpose: Code shared between the frontend (React) and backend (Deno/Supabase Edge Functions).
    Details: Contains core services logic, utility functions, and type definitions used across the application.
    â”œâ”€â”€ ğŸ“ lib/
    â”‚   Purpose: Shared, low-level utility functions.
    â”‚   â”œâ”€â”€ ğŸ“„ uuid-utils.ts
    â”‚   â”‚   Purpose: Shared, canonical utility functions for validating and cleaning UUID strings.
    â”‚   â”‚   Details: Provides `isValidUuid(id)` to check format via regex. Provides `cleanUuid(id)` to sanitize by removing trailing spaces/digits before validation.
    â”‚   â”‚   Usage: Used across frontend/backend for UUID validation/sanitization, replacing previous duplicate implementations.
    â”‚   â”‚
    â”‚   â””â”€â”€ ğŸ“„ uuid.ts
    â”‚       Purpose: Shared, canonical implementation for generating UUID v4 strings.
    â”‚       Details: Uses `v4 as uuidv4` from the `uuid` npm package. Exports `generateId()`.
    â”‚       Usage: Standard way to generate unique IDs across the application (elements, sections, projects, etc.), replacing previous implementations.
    â”‚
    â”œâ”€â”€ ğŸ“ services/
    â”‚   Purpose: Core implementation logic for key application services, designed to be adapted for specific environments.
    â”‚   â”œâ”€â”€ ğŸ“„ differ.ts
    â”‚   â”‚   Purpose: Core, shared implementation for comparing two `EmailTemplate` (V2) objects and generating a detailed diff.
    â”‚   â”‚   Details: Contains `DifferCore` class. Requires Lodash instance. Methods `diffTemplates`, `diffSections`, `diffElements`, `diffProperties` compare structures based on IDs and properties, tracking additions, removals, modifications, moves. Returns `TemplateDiffResult`.
    â”‚   â”‚   Usage: Base class for frontend/backend adapters. Used by `generate-email-changes` backend function to compute pending changes.
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ğŸ“„ htmlGenerator.ts
    â”‚   â”‚   Purpose: Core, shared implementation for generating HTML email strings from structured `EmailTemplate` (V2) objects.
    â”‚   â”‚   Details: Contains `HtmlGeneratorCore` class (implements `IHtmlGenerator`). Main `generate` method builds the document. Protected methods (`generateSectionHtml`, `generateElementHtml`, etc.) handle parts of the template. Follows adapter pattern. Includes robust HTML/CSS, resets, and email client compatibility fixes.
    â”‚   â”‚   Usage: Base class for frontend/backend adapters. Core logic for converting `EmailTemplateV2` to HTML.
    â”‚   â”‚
    â”‚   â””â”€â”€ ğŸ“„ semanticParser.ts
    â”‚       Purpose: Core, shared implementation logic for parsing HTML email strings into structured `EmailTemplate` (V2) objects.
    â”‚       Details: Contains `SemanticParserCore` class (implements `ISemanticParser`). Abstract `parse` method requires adapter implementation. Protected methods (`extractGlobalStyles`, `extractSectionStyles`, `extractElementProperties`, etc.) handle parsing logic. Includes helper utilities.
    â”‚       Usage: Base class for frontend/backend adapters. Enables converting raw HTML into the application's structured `EmailTemplateV2` format.
    â”‚
    â””â”€â”€ ğŸ“ types/
        Purpose: Shared TypeScript type definitions and configurations used across the entire application.
        â”œâ”€â”€ ğŸ“ config/
        â”‚   Purpose: Default configurations for shared entities.
        â”‚   â””â”€â”€ ğŸ“„ elementDefaults.ts
        â”‚       Purpose: Defines default configurations (styles, layout, properties) for all V2 email element types and provides a factory function.
        â”‚       Details: Exports `elementDefaults` constant mapping `ElementTypeV2` to default objects (using `@@PLACEHOLDER_...@@` markers). Exports `createNewElement(type, initialContent?)` factory function using `generateId` and deep copying defaults.
        â”‚       Usage: Used when creating new elements programmatically (AI/backend) or via UI (editor) to ensure consistency.
        â”‚
        â”œâ”€â”€ ğŸ“„ common.ts
        â”‚   Purpose: Defines common, fundamental TypeScript types shared across the application.
        â”‚   Details: Exports `InteractionMode` union type (`'ask' | 'edit' | 'major'`).
        â”‚   Usage: Provides basic shared types, imported where needed (e.g., `EditorContext`).
        â”‚
        â”œâ”€â”€ ğŸ“„ diffs.ts
        â”‚   Purpose: Defines TypeScript interfaces for representing the results of diffing email templates.
        â”‚   Details: Exports `PropertyChange`, `ElementDiff`, `SectionDiff`, `TemplateDiffResult`. Defines the structure returned by `DifferCore`.
        â”‚   Usage: Used by `DifferCore` service and consumers of diff results (e.g., `EditorContext` for pending changes).
        â”‚
        â”œâ”€â”€ ğŸ“„ editor.ts
        â”‚   Purpose: Defines TypeScript types specific to the editor interface, primarily for chat/messaging.
        â”‚   Details: Exports `ChatMessage` interface (`id`, `project_id`, `role`, `content`, `timestamp`, `isError`).
        â”‚   Usage: Used by frontend components (`ChatInterface`, `EditorContext`) for chat data.
        â”‚
        â”œâ”€â”€ ğŸ“„ elements.ts
        â”‚   Purpose: Defines all TypeScript types related to individual email elements within the V2 template structure.
        â”‚   Details: Exports `ElementType` union. Defines `EmailElementLayout` and specific property interfaces (`HeaderElementProperties`, `ImageElementProperties`, etc.) for all types. Exports the main `EmailElement` discriminated union.
        â”‚   Usage: Foundational types used by services, contexts, validation, and defaults for defining email content elements.
        â”‚
        â”œâ”€â”€ ï¿½ï¿½ index.ts
        â”‚   Purpose: Barrel file for the `src/shared/types` directory.
        â”‚   Details: Explicitly re-exports types from `elements.ts`, `sections.ts`, `template.ts`, `validators.ts`, `diffs.ts`.
        â”‚   Usage: Provides a single import point (`@shared/types`) for common shared types.
        â”‚
        â”œâ”€â”€ ğŸ“„ pendingChangeTypes.ts
        â”‚   Purpose: Defines TypeScript types for representing proposed template changes awaiting approval.
        â”‚   Details: Exports `PendingChangeInput` (for creation) and `PendingChange` (for stored record, includes metadata).
        â”‚   Usage: Structures data for the pending changes workflow (backend functions, frontend context/UI).
        â”‚
        â”œâ”€â”€ ğŸ“„ sections.ts
        â”‚   Purpose: Defines TypeScript types for email template sections.
        â”‚   Details: Exports `EmailSectionStyles` and `EmailSection` (id, elements array, styles) interfaces.
        â”‚   Usage: Part of the core `EmailTemplateV2` structure, used by services handling template structure.
        â”‚
        â”œâ”€â”€ ğŸ“„ template.ts
        â”‚   Purpose: Defines the top-level TypeScript types for the V2 email template structure.
        â”‚   Details: Exports `EmailGlobalStyles` and the main `EmailTemplate` (id, name, version, sections array, globalStyles) interfaces.
        â”‚   Usage: The central data structure for email content, used extensively by services, contexts, and backend functions.
        â”‚
        â””â”€â”€ ğŸ“„ validators.ts
            Purpose: Provides Zod schemas and a validation function specifically for the `EmailTemplate` V2 structure.
            Details: Defines comprehensive Zod schemas for all parts of `EmailTemplateV2`, including layouts, element properties, sections, global styles. Uses placeholders. Exports `validateEmailTemplateV2(templateData)` function using `safeParse`. Requires `version: 2`.
            Usage: Ensures data integrity, especially for AI-generated content. Used primarily in backend functions (e.g., `generate-email-changes`) before saving data.

